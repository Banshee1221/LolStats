{% extends "template.html" %}
{% block title %}
    <title>{{ playername }} | Stats</title>
{% endblock %}

{% block header %}
    <link href="{{ url_for('static', filename='css/stats.css') }}" rel="stylesheet">
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">LolStats</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#">Link</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
{% endblock %}

{% block content %}
    <script>
        $(document).ready(function () {
            var temp = {{ jsonData|tojson }};
            var amount = temp.length;
            function createDiv(item, win, lane, assist, gold, kills, deaths, id, minionK, time, champ) {
                var iDiv = document.createElement('div');
                iDiv.id = id.toString();
                var img = document.createElement('div');
                var eleLane = document.createElement('div');
                var killDiv = document.createElement('table');
                var goldCreeps = document.createElement('table');
                img.className = 'floater col-md-1';
                //var lo = '<img src="http://ddragon.leagueoflegends.com/cdn/5.2.1/img/champion/'+champ.toString()+'.png" width=75px>';
                var lo = '<p>' + champ.toString() + '</p>';
                img.innerHTML = lo;
                killDiv.className = 'floater col-sm-2 table table-condensed border-free-table';
                killDiv.innerHTML = '<tbody><tr><td>Kills: </td><td>'+kills+'</td></tr>' +
                '<tr><td>Deaths: </td><td>'+deaths+'</td></tr>' +
                '<tr><td>Assists: </td><td>'+assist+'</td></tr></tbody>';
                eleLane.className = 'floater port col-md-3';
                eleLane.innerHTML = '<p>Lane: '+lane+'</p>';
                goldCreeps.className = 'col-sm-2 table table-condensed border-free-table rightTab';
                goldCreeps.innerHTML = '<tbody><tr><td>Gold: </td><td>'+gold+'</td></tr>' +
                '<tr><td>Creeps: </td><td>'+minionK+'</td></tr></tbody>';
                if (win == false) {
                    iDiv.className = 'col-md-12 bg-danger padder';
                }
                else {
                    iDiv.className = 'col-md-12 bg-success padder';
                }
                document.getElementsByClassName('col-md-8')[0].appendChild(iDiv);
                document.getElementById(id.toString()).appendChild(img);
                document.getElementById(id.toString()).appendChild(killDiv);
                document.getElementById(id.toString()).appendChild(eleLane);
                document.getElementById(id.toString()).appendChild(goldCreeps);
            }

            for (var i = 0; i < amount; i++) {
                var temp1 = temp[i];
                createDiv(i, temp1['winner'], temp1['lane'], temp1['assists'], temp1['gold'], temp1['kills'], temp1['deaths'],
                temp1['matchId'], temp1['minionsKilled'], temp1['matchDuration'], temp1['champion']);
            }



        })
    </script>

    <div class="col-md-4 left">
        <div class="col-md-12">
            <div id='chart_div' style="padding: 0; margin: 0; width:425px; height:425px"></div>
{#            <svg style="background: url({{ url_for('static', filename='images/vector_minimap.jpg.svg') }}) no-repeat center; background-size: 100%"></svg>#}

        </div><script type="text/javascript">
        var matches = {'1': []}
        $(function () {
            $('#chart_div').highcharts({
                chart: {
                    type: 'scatter',
                    plotBackgroundImage:"{{ url_for('static', filename='images/vector_minimap.jpg.svg') }}"
                },
                title: {
                    text: '',
                    style: {
                        display: 'none'
                    }
                },
                xAxis: {
                    min: -120,
                    max: 14870,
                    lineWidth: 0,
                    gridLineWidth: 0,
                    minorGridLineWidth: 0,
                    lineColor: 'transparent',
                    labels: {
                        enabled: false
                    },
                    minorTickLength: 0,
                    tickLength: 0
                },
                yAxis: {
                    min: -120,
                    max: 14980,
                    lineWidth: 0,
                    gridLineWidth: 0,
                    minorGridLineWidth: 0,
                    lineColor: 'transparent',
                    labels: {
                        enabled: false
                    },
                    minorTickLength: 0,
                    tickLength: 0
                },
                series: [{
                    data: [1, 0, 4]
                }, {
                    data: [5, 7, 3]
                },
                {
                    data: [5, 7, 3]
                }],
                credits:{
                    enabled:false
                }
            });
        });


        function getPoints() {
            var t1 = JSON.stringify(matches);
            var chart = $('#chart_div').highcharts();
            $.ajax("/stats/{{ region }}/{{ playername }}", {
                data: t1,
                contentType: "application/json",
                type: "POST",
                async: false,
                success: function (data) {
                    //console.log(data['matchData']);
                    temper = data['matchData'];
                }
            });
            var k = [];
            var d = [];
            var a = [];
            chart.series[2].remove();
            chart.series[1].remove();
            chart.series[0].remove();
            for (var i = 0; i < temper['games'].length; i++) {
                for (var j = 0; j < temper['games'][i]['kills'].length; j++)
                    k.push([temper['games'][i]['kills'][j]['position']['x'], temper['games'][i]['kills'][j]['position']['y']]);
                for (var j = 0; j < temper['games'][i]['deaths'].length; j++)
                    d.push([temper['games'][i]['deaths'][j]['position']['x'], temper['games'][i]['deaths'][j]['position']['y']]);
                for (var j = 0; j < temper['games'][i]['assists'].length; j++)
                    a.push([temper['games'][i]['assists'][j]['position']['x'], temper['games'][i]['assists'][j]['position']['y']]);
            }
            chart.addSeries({
                name: 'k',
                data: k
            });
            chart.addSeries({
                name: 'd',
                data: d
            });
            chart.addSeries({
                name: 'a',
                data: a
            });
        }




        $(document).ready(function () {
            $('#rightDiv').click(function (e) {
                //if ($(e.target).hasClass('padder'))
                var width = $(this).width();
                matches['1'].push(parseInt(event.target.id));
                getPoints();
                $('#' + event.target.id).animate({
                    left: "+=50",
                    width: (width - 50)
                }, 500, function () {
                    // Animation complete.
                });
            });
        });
    </script>
    </div>
    <div id="rightDiv" class="col-md-8 right" style="height: 1000px; overflow:auto;">
{#        <div style="display:table;height:100%;" class="bg-danger padder">#}
{#            <div style="float:left;display:table-cell;vertical-align:middle;" class="imag col-md-1">#}
{#                test#}
{#            </div>#}
{#            <div style="float:left" class="col-md-1 textContainer">#}
{#                test2#}
{#            </div>#}
{#            <table style="float:left; width: 134px;" class="col-sm-2 table table-condensed border-free-table">#}
{#                <tbody>#}
{#                    <tr>#}
{#                        <td>Kills: </td>#}
{#                        <td>'+kills+'</td>#}
{#                    </tr>#}
{#                    <tr>#}
{#                        <td>Deaths: </td>#}
{#                        <td>'+deaths+'</td>#}
{#                    </tr>#}
{#                    <tr>#}
{#                        <td>Assists: </td>#}
{#                        <td>'+assist+'</td>#}
{#                    </tr>#}
{#                </tbody>#}
{#            </table>#}
{##}
{#        </div>#}
    </div>
{% endblock %}